{% extends "base.html" %}
{% block title %}How to Play — Pinwheel Fates{% endblock %}

{% block content %}
{# ===== HERO ===== #}
<div class="play-hero">
  <h1>Join the League</h1>
  <p class="play-hero-sub">
    Pinwheel Fates is a basketball league where the players write the rules.
    Games run automatically. Between rounds, you propose changes in plain English,
    vote with your team, and reshape the game.
  </p>
  {% if discord_invite_url %}
  <a href="{{ discord_invite_url }}" class="play-join-btn" target="_blank" rel="noopener">
    Join the Discord
  </a>
  {% endif %}
</div>

{# ===== SEASON STATUS ===== #}
{% if season_name %}
<div class="play-status">
  <div class="play-status-item" style="flex:2;">
    <span class="play-status-value" style="font-size:1.4rem;">{{ season_name }}</span>
    <span class="play-status-label">{{ season_phase_desc }}</span>
  </div>
  {% if current_round > 0 %}
  <div class="play-status-item">
    <span class="play-status-value">{{ current_round }}</span>
    <span class="play-status-label">Rounds Played</span>
  </div>
  {% endif %}
  <div class="play-status-item">
    <span class="play-status-value">{{ total_teams }}</span>
    <span class="play-status-label">Teams</span>
  </div>
  <div class="play-status-item">
    <span class="play-status-value">{{ total_games }}</span>
    <span class="play-status-label">Games Played</span>
  </div>
</div>
{% endif %}

{# ===== HOW TO JOIN ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">How to Join</span>
  </div>
  <div class="play-join-steps">
    <div class="join-step">
      <div class="join-step-num" style="color:var(--accent-highlight);">1</div>
      <div class="join-step-content">
        <strong>Join the Discord</strong> and type <code>/join TEAM</code> to enroll on a team.
        {% if team_names %}
        Current teams: <strong>{{ team_names | join('</strong>, <strong>') }}</strong>.
        {% endif %}
        You're locked to that team for the season.
      </div>
    </div>
    <div class="join-step">
      <div class="join-step-num" style="color:var(--accent-governance);">2</div>
      <div class="join-step-content">
        <strong>You receive 6 governance tokens:</strong> 2 PROPOSE, 2 AMEND, 2 BOOST.
        These let you submit rule changes, modify proposals, and double your vote weight.
      </div>
    </div>
    <div class="join-step">
      <div class="join-step-num" style="color:var(--accent-score);">3</div>
      <div class="join-step-content">
        <strong>Start governing.</strong> Propose rule changes, vote, trade tokens, and set team strategy.
        The Floor opens between rounds.
      </div>
    </div>
  </div>
</div>

{# ===== SEASON STRUCTURE ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Season Structure</span>
  </div>
  <p class="play-intro">
    A season is a round-robin schedule. {{ total_teams }} teams play each other.
    After each round, proposals are tallied and winning proposals take effect immediately.
  </p>
  <div class="play-season-flow">
    <div class="season-flow-step">
      <div class="season-flow-icon" style="color:var(--accent-highlight);">&#9654;</div>
      <h4>Regular Season</h4>
      <p>Round-robin — every team plays every other team. Games run automatically {{ pace_desc }}.</p>
    </div>
    <div class="season-flow-arrow">&rarr;</div>
    <div class="season-flow-step">
      <div class="season-flow-icon" style="color:var(--accent-score);">&#9733;</div>
      <h4>Playoffs</h4>
      <p>Top teams enter playoffs. Semifinals (best of 3), then finals (best of 5).</p>
    </div>
    <div class="season-flow-arrow">&rarr;</div>
    <div class="season-flow-step">
      <div class="season-flow-icon" style="color:var(--accent-governance);">&#9878;</div>
      <h4>New Season</h4>
      <p>The champion is crowned. Rules carry forward. Teams keep their hoopers. A new season begins.</p>
    </div>
  </div>
</div>

{# ===== THE RHYTHM ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">The Rhythm</span>
  </div>
  <p class="play-intro">
    Every round follows the same cycle. Rounds advance {{ pace_desc }}.
  </p>
  <div class="play-rhythm">
    <div class="rhythm-step">
      <div class="rhythm-num" style="color:var(--accent-highlight);">1</div>
      <div class="rhythm-content">
        <h3 class="rhythm-title">Games Play Out</h3>
        <p class="rhythm-desc">
          3-on-3 basketball, fully simulated. Each team has three hoopers with
          unique attributes, archetypes, and special moves. Every game ends with
          an Elam Ending &mdash; first to the target score wins. No clock, no
          garbage time. You can follow every possession, every shot, every steal.
        </p>
      </div>
    </div>
    <div class="rhythm-step">
      <div class="rhythm-num" style="color:var(--accent-governance);">2</div>
      <div class="rhythm-content">
        <h3 class="rhythm-title">The Floor Opens</h3>
        <p class="rhythm-desc">
          Propose rule changes and vote any time — proposals stay open
          until the next governance tally (every {{ gov_interval }} round{{ "s" if gov_interval != 1 }}). Write proposals in plain English:
          <em>"Make three-pointers worth 4 points"</em> or
          <em>"Reduce the shot clock to 15 seconds."</em>
          The AI interprets your words into specific parameter changes.
          You confirm the interpretation, then your team votes. Majority wins.
        </p>
      </div>
    </div>
    <div class="rhythm-step">
      <div class="rhythm-num" style="color:var(--accent-report);">3</div>
      <div class="rhythm-content">
        <h3 class="rhythm-title">The Reporter</h3>
        <p class="rhythm-desc">
          After each round, the AI files three reports.
          <strong>Simulation Report</strong> (public): what happened in the games, statistical patterns, effects of rule changes.
          <strong>Governance Report</strong> (public): voting trends, coalitions, who is proposing what.
          <strong>Private Report</strong> (DM to you): your own governance behavior reflected back. Patterns you might not see. Never prescribes &mdash; only describes.
        </p>
      </div>
    </div>
    <div class="rhythm-step">
      <div class="rhythm-num" style="color:var(--accent-score);">4</div>
      <div class="rhythm-content">
        <h3 class="rhythm-title">The Rules Change</h3>
        <p class="rhythm-desc">
          Passed proposals take effect immediately. The next round plays under
          the rules you wrote. Three-pointers worth 4? A 20-second shot clock?
          Bonus free throws after 3 team fouls? The league becomes whatever its
          players decide it should be.
        </p>
      </div>
    </div>
  </div>
</div>

{# ===== TOKEN ECONOMY ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Governance Tokens</span>
  </div>
  <p class="play-intro">
    You receive tokens when you join. Spend them to propose, amend, and boost. Tokens are tradeable between players via <code>/trade</code>.
  </p>
  <div class="play-tokens-grid">
    <div class="play-token-card">
      <div class="play-token-name" style="color:var(--accent-governance);">PROPOSE</div>
      <div class="play-token-count">2 on join</div>
      <p class="play-token-desc">Submit a rule change to the Floor. Costs 1 per proposal (2 for wild proposals). Regenerates 2 per tally cycle.</p>
    </div>
    <div class="play-token-card">
      <div class="play-token-name" style="color:var(--accent-report);">AMEND</div>
      <div class="play-token-count">2 on join</div>
      <p class="play-token-desc">Modify someone else's proposal before it goes to vote. Regenerates 2 per tally cycle.</p>
    </div>
    <div class="play-token-card">
      <div class="play-token-name" style="color:var(--accent-highlight);">BOOST</div>
      <div class="play-token-count">2 on join</div>
      <p class="play-token-desc">Double your vote weight on a single vote. Scarce &mdash; does not regenerate at tally. Only restored between seasons.</p>
    </div>
  </div>
</div>

{# ===== VOTING ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Voting</span>
  </div>
  <div class="play-voting-details">
    <p class="play-intro">
      Type <code>/vote YES</code> or <code>/vote NO</code> on an active proposal.
    </p>
    <div class="play-vote-rules">
      <div class="play-vote-rule">
        <strong>Weight:</strong> Each team's total vote weight is 1.0, split equally among its governors. If your team has 3 governors, your weight is 0.33.
      </div>
      <div class="play-vote-rule">
        <strong>Boosting:</strong> Add <code>boost: True</code> to your vote to double your weight. This spends one BOOST token.
      </div>
      <div class="play-vote-rule">
        <strong>Ties fail.</strong> Votes are tallied after each round. Passed proposals change rules immediately.
      </div>
    </div>
  </div>
</div>

{# ===== PROPOSAL TIERS ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Proposal Tiers</span>
  </div>
  <p class="play-intro">
    Proposals are classified by what they change. Higher tiers need more support to pass.
  </p>
  <div class="play-tiers">
    <div class="play-tier-row">
      <span class="play-tier-num" style="color:var(--accent-highlight);">T1</span>
      <span class="play-tier-label">Game Mechanics</span>
      <span class="play-tier-detail">Shot clock, scoring, fouls &mdash; 50% to pass</span>
    </div>
    <div class="play-tier-row">
      <span class="play-tier-num" style="color:var(--accent-governance);">T2</span>
      <span class="play-tier-label">Agent Behavior</span>
      <span class="play-tier-detail">Shot limits, home court &mdash; 50% to pass</span>
    </div>
    <div class="play-tier-row">
      <span class="play-tier-num" style="color:var(--accent-score);">T3</span>
      <span class="play-tier-label">League Structure</span>
      <span class="play-tier-detail">Teams, playoffs, schedule &mdash; 60% to pass</span>
    </div>
    <div class="play-tier-row">
      <span class="play-tier-num" style="color:var(--accent-report);">T4</span>
      <span class="play-tier-label">Meta-Governance</span>
      <span class="play-tier-detail">Vote thresholds, token regen &mdash; 60% to pass</span>
    </div>
    <div class="play-tier-row">
      <span class="play-tier-num" style="color:var(--accent-elam);">T5+</span>
      <span class="play-tier-label">Wild</span>
      <span class="play-tier-detail">Novel or uninterpretable &mdash; costs 2 PROPOSE, 67% to pass</span>
    </div>
  </div>
</div>

{# ===== THE WILD CARD ===== #}
<div class="rules-wildcard">
  <div class="wildcard-inner">
    <div class="wildcard-label">Beyond the Numbers</div>
    <h2 class="wildcard-headline">
      Want to change the rules? Propose new ones &mdash;
      <span class="wc-accent">anything.</span>
    </h2>
    <p class="wildcard-body">
      Want to make the floor lava? Introduce a maximum height rule? Switch to
      baseball? Require all players to hop on one foot? <strong>Write it in
      plain English.</strong> The AI interprets your proposal into mechanics.
      Your team votes. If it passes, it reshapes the game. The simulation
      engine evolves to match.
    </p>

    <div class="wildcard-examples">
      <div class="wildcard-example">
        &ldquo;Make three-pointers worth 10 points when scored in the last minute.&rdquo;
      </div>
      <div class="wildcard-example">
        &ldquo;If a team scores 5 times in a row, the other team gets a free possession.&rdquo;
      </div>
      <div class="wildcard-example">
        &ldquo;Switch to baseball for one round.&rdquo;
      </div>
      <div class="wildcard-example">
        &ldquo;All hoopers must have at least 30 Speed.&rdquo;
      </div>
      <div class="wildcard-example">
        &ldquo;If the score is tied at halftime, play the second half with 4 players per team.&rdquo;
      </div>
      <div class="wildcard-example">
        &ldquo;Add a weather system &mdash; rain reduces three-point accuracy by 20%.&rdquo;
      </div>
    </div>

    <div class="wildcard-flow">
      <span class="wildcard-flow-step">You propose</span>
      <span class="wildcard-flow-arrow">&rarr;</span>
      <span class="wildcard-flow-step">AI interprets</span>
      <span class="wildcard-flow-arrow">&rarr;</span>
      <span class="wildcard-flow-step">You confirm</span>
      <span class="wildcard-flow-arrow">&rarr;</span>
      <span class="wildcard-flow-step">Your team votes</span>
      <span class="wildcard-flow-arrow">&rarr;</span>
      <span class="wildcard-flow-step">The game changes</span>
    </div>
  </div>
</div>

{# ===== KEY GAME PARAMETERS ===== #}
{% if key_params %}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Current Game Parameters</span>
  </div>
  <p class="play-intro">
    These are the numbers that define the game right now. Governors can change any of them.
  </p>
  <div class="rules-tier-grid">
    {% for param in key_params %}
    <div class="rule-card {% if param.changed %}rule-card-changed{% endif %}">
      <div class="rule-card-header">
        <span class="rule-card-label">{{ param.label }}</span>
        <span class="rule-card-value {% if param.changed %}rule-card-value-changed{% endif %}">{{ param.value }}</span>
      </div>
      <div class="rule-card-desc">{{ param.desc }}</div>
    </div>
    {% endfor %}
  </div>
  {% if community_changes > 0 %}
  <p class="play-intro" style="margin-top:1rem;">
    <span style="color:var(--accent-highlight); font-weight:700;">{{ community_changes }}</span>
    rule{{ 's' if community_changes != 1 else '' }} changed by the community so far.
    <a href="/rules">See all rules &rarr;</a>
  </p>
  {% endif %}
</div>
{% endif %}

{# ===== WHAT YOU DO ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">What You Do</span>
  </div>
  <div class="play-roles-grid">
    <div class="play-role-card">
      <div class="play-role-icon" style="color:var(--accent-highlight);">&#9654;</div>
      <h4 class="play-role-title">Watch</h4>
      <p class="play-role-desc">
        Follow your team's games. Read the play-by-play. Study the box scores.
        Know your hoopers &mdash; their strengths, their tendencies, their
        special moves.
      </p>
    </div>
    <div class="play-role-card">
      <div class="play-role-icon" style="color:var(--accent-governance);">&#9998;</div>
      <h4 class="play-role-title">Propose</h4>
      <p class="play-role-desc">
        See something you want to change? Use <code>/propose</code> in
        Discord. Write it in plain English. The AI interprets it into a
        parameter change and presents it to your team.
      </p>
    </div>
    <div class="play-role-card">
      <div class="play-role-icon" style="color:var(--accent-score);">&#9745;</div>
      <h4 class="play-role-title">Vote</h4>
      <p class="play-role-desc">
        Your team votes on proposals together. Think strategically &mdash;
        the rules you pass shape the game your hoopers play.
        A rule that helps your team might also help your rivals.
      </p>
    </div>
    <div class="play-role-card">
      <div class="play-role-icon" style="color:var(--accent-report);">&#10070;</div>
      <h4 class="play-role-title">Reflect</h4>
      <p class="play-role-desc">
        Read the reports. The AI surfaces what the data shows &mdash;
        not opinions, not instructions, just patterns. You also get a
        <strong>private report</strong> via DM with your own governance
        patterns reflected back.
      </p>
    </div>
  </div>
</div>

{# ===== DISCORD COMMANDS ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Discord Commands</span>
  </div>
  <p class="play-intro">
    The Floor is on Discord. Here are the commands you'll use.
  </p>
  <div class="play-commands">
    <div class="play-cmd">
      <code class="play-cmd-name">/join</code>
      <span class="play-cmd-desc">Enroll on a team and become a governor</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/propose</code>
      <span class="play-cmd-desc">Submit a rule change proposal in plain English</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/vote</code>
      <span class="play-cmd-desc">Vote yes or no on an active proposal (add boost: True to double your weight)</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/strategy</code>
      <span class="play-cmd-desc">Set your team's game plan and offensive focus</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/bio</code>
      <span class="play-cmd-desc">Write a backstory for one of your hoopers</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/tokens</code>
      <span class="play-cmd-desc">Check your PROPOSE, AMEND, and BOOST token balances</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/trade</code>
      <span class="play-cmd-desc">Trade tokens with another governor</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/trade-hooper</code>
      <span class="play-cmd-desc">Propose trading hoopers between teams</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/standings</code>
      <span class="play-cmd-desc">View current league standings</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/schedule</code>
      <span class="play-cmd-desc">View upcoming game matchups</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/reports</code>
      <span class="play-cmd-desc">View the latest AI reports</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/profile</code>
      <span class="play-cmd-desc">View your governance record and activity</span>
    </div>
    <div class="play-cmd">
      <code class="play-cmd-name">/proposals</code>
      <span class="play-cmd-desc">View all proposals and their status</span>
    </div>
  </div>
</div>

{# ===== FAQ ===== #}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Questions</span>
  </div>
  <div class="play-faq">
    <div class="play-faq-item">
      <h4 class="play-faq-q">What's the Elam Ending?</h4>
      <p class="play-faq-a">
        After the {{ "3rd" }} quarter, the leading team's score plus a target
        margin becomes the number to hit. From that point, the first team to
        reach the target wins. No clock &mdash; every possession is sudden death.
        It's borrowed from real basketball (the NBA All-Star Game uses it) and
        it means every game ends on a made basket.
      </p>
    </div>
    <div class="play-faq-item">
      <h4 class="play-faq-q">What happens when a proposal passes?</h4>
      <p class="play-faq-a">
        The rule changes immediately. The next round of games plays under the
        new rules. You can see every rule that's been changed by the community
        on the <a href="/rules">Rules page</a>. The change history is permanent
        &mdash; nothing gets erased.
      </p>
    </div>
    <div class="play-faq-item">
      <h4 class="play-faq-q">Can I break the game?</h4>
      <p class="play-faq-a">
        Every rule has a valid range (the AI won't let you set the shot clock
        to negative infinity). But within those ranges, you can push things
        pretty far. That's the point. The game is a sandbox for collective
        self-government &mdash; you learn what works by trying things.
      </p>
    </div>
    <div class="play-faq-item">
      <h4 class="play-faq-q">What does the AI actually do?</h4>
      <p class="play-faq-a">
        Three things. First, it interprets your plain-English proposals into
        specific parameter changes. Second, it writes reports &mdash; public
        analysis of what's happening in the league, plus a private DM report
        reflecting your own governance behavior. Third, it provides
        game commentary. It never makes decisions for you. It never votes.
        It never proposes rules. It's a reporter, not a player.
      </p>
    </div>
    <div class="play-faq-item">
      <h4 class="play-faq-q">What happens between seasons?</h4>
      <p class="play-faq-a">
        When a champion is crowned, the season archives. Teams, hoopers, and
        governor enrollments carry over. Rules carry forward unless you write
        otherwise. Everyone gets fresh tokens. A new season begins &mdash;
        no need to re-enroll.
      </p>
    </div>
    <div class="play-faq-item">
      <h4 class="play-faq-q">Is this free?</h4>
      <p class="play-faq-a">
        Yes. Pinwheel Fates is open source and free to play.
      </p>
    </div>
  </div>
</div>

{# ===== JOIN CTA ===== #}
<div class="play-cta">
  {% if discord_invite_url %}
  <a href="{{ discord_invite_url }}" class="play-join-btn" target="_blank" rel="noopener">
    Join the Discord
  </a>
  <p class="play-cta-sub">
    Use <code>/join TEAM</code> once you're in.
    {% if team_names %}Pick from: <strong>{{ team_names | join('</strong>, <strong>') }}</strong>.{% endif %}
    You'll be assigned to that team and the next time the Floor opens is your first chance to shape the game.
  </p>
  {% else %}
  <p class="play-cta-sub">
    The league is live. Explore the <a href="/arena">Arena</a>,
    check the <a href="/standings">Standings</a>, or read
    the <a href="/rules">Rules</a> to see the game as it stands.
  </p>
  {% endif %}
</div>
{% endblock %}
