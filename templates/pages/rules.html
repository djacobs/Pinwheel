{% extends "base.html" %}
{% block title %}The Rules â€” Pinwheel Fates{% endblock %}

{% block content %}
<div class="rules-hero">
  <h1>The Rules</h1>
  <p class="rules-hero-tagline">
    Every number below shapes how this league plays. Between rounds, you propose changes
    in plain English and vote with your team. The AI translates your proposals into
    mechanics &mdash; but the decisions are yours.
  </p>
  {% if community_changes > 0 %}
  <div class="rules-hero-stat">
    <span style="color:var(--accent-highlight); font-weight:800;">{{ community_changes }}</span>
    rule{{ 's' if community_changes != 1 else '' }} changed by the community
  </div>
  {% endif %}
</div>

{% if changes_from_default %}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text" style="color:var(--accent-highlight);">Changed by the Community</span>
  </div>
  <div class="rules-changed-strip">
    {% for param, info in changes_from_default.items() %}
    <div class="rule-changed-card">
      <div class="rule-changed-param">{{ param.replace('_', ' ').title() }}</div>
      <div class="rule-changed-values">
        <span class="rule-old">{{ info.default }}</span>
        <span class="rule-arrow">&rarr;</span>
        <span class="rule-new">{{ info.current }}</span>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% for tier in tiers %}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">{{ tier.title }}</span>
  </div>
  <p class="rules-tier-subtitle">{{ tier.subtitle }}</p>
  <div class="rules-tier-grid">
    {% for rule in tier.rules %}
    <div class="rule-card {% if rule.changed %}rule-card-changed{% endif %}">
      <div class="rule-card-header">
        <span class="rule-card-label">{{ rule.label }}</span>
        {% if rule.value is sameas true %}
        <span class="rule-card-value rule-bool-on">ON</span>
        {% elif rule.value is sameas false %}
        <span class="rule-card-value rule-bool-off">OFF</span>
        {% else %}
        <span class="rule-card-value {% if rule.changed %}rule-card-value-changed{% endif %}">{{ rule.value }}</span>
        {% endif %}
      </div>
      <div class="rule-card-desc">{{ rule.desc }}</div>
      {% if rule.range %}
      <div class="rule-card-range">Range: {{ rule.range }}</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endfor %}

{% if rule_history %}
<div class="home-section">
  <div class="section-title-bar">
    <span class="section-title-text">Change History</span>
  </div>
  {% for rc in rule_history %}
  <div class="rule-history-item">
    <span class="rule-history-param">{{ rc.parameter.replace('_', ' ').title() }}</span>
    <span class="rule-history-change">
      <span class="rule-old">{{ rc.old_value }}</span>
      <span class="rule-arrow">&rarr;</span>
      <span class="rule-new">{{ rc.new_value }}</span>
    </span>
    <span class="rule-history-round">Round {{ rc.round_enacted }}</span>
  </div>
  {% endfor %}
</div>
{% endif %}

<div class="rules-cta">
  <p>Want to change a rule? Use <code>/propose</code> in Discord.</p>
  <p class="text-muted text-sm">Write your proposal in plain English. The AI will interpret it into a specific parameter change. Your team votes.</p>
</div>
{% endblock %}
