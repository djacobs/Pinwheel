{% extends "base.html" %}

{% block title %}Governor Roster — Admin — Pinwheel Fates{% endblock %}

{% block content %}
<h1>Governor Roster</h1>
<p class="text-muted">All players and their team assignments.</p>

{% if not governors %}
<div class="empty-state">
  <h3>No Governors Yet</h3>
  <p>No one has joined a team yet. Players join via <code>/join</code> in Discord.</p>
</div>
{% else %}

<div class="card mb-2">
  <div class="card-header">
    <h3>{{ governors|length }} Governor{{ 's' if governors|length != 1 else '' }}</h3>
  </div>
  <div class="card-body" style="padding: 0;">
    <table class="box-score-table">
      <thead>
        <tr>
          <th style="text-align:left">Governor</th>
          <th style="text-align:left">Team</th>
          <th style="text-align:left">Joined</th>
          <th>PROPOSE</th>
          <th>AMEND</th>
          <th>BOOST</th>
          <th>Proposals</th>
          <th>Passed</th>
          <th>Pending</th>
          <th>Failed</th>
          <th>Votes</th>
        </tr>
      </thead>
      <tbody>
        {% for g in governors %}
        <tr>
          <td style="text-align:left;">
            <a href="/governors/{{ g.id }}">{{ g.username }}</a>
          </td>
          <td style="text-align:left;">
            <span class="team-dot-sm tc-dot" style="--tc: {{ g.team_color }};"></span>
            {{ g.team_name }}
          </td>
          <td style="text-align:left; font-size: 0.85rem;" class="mono">{{ g.joined.strftime('%b %d') if g.joined else '—' }}</td>
          <td class="mono">{{ g.propose }}</td>
          <td class="mono">{{ g.amend }}</td>
          <td class="mono">{{ g.boost }}</td>
          <td class="mono">{{ g.proposals_submitted }}</td>
          <td class="mono" style="color: var(--accent-score);">{{ g.proposals_passed }}</td>
          <td class="mono" style="color: var(--accent-gov);">{{ g.proposals_pending }}</td>
          <td class="mono" style="color: var(--accent-game);">{{ g.proposals_failed }}</td>
          <td class="mono">{{ g.votes_cast }}</td>
        </tr>
        {% if g.pending_interpretations %}
        <tr>
          <td colspan="11" style="padding: 0.25rem 1rem 0.5rem 2rem; border-top: none;">
            {% for pi in g.pending_interpretations %}
            <div style="font-size: 0.8rem; margin-bottom: 0.25rem; line-height: 1.4;">
              <span class="mono" style="font-size: 0.7rem; padding: 0.1rem 0.4rem; border-radius: 3px; margin-right: 0.5rem;
                {% if pi.status == 'EXPIRED' %}background: rgba(231,76,60,0.2); color: var(--accent-game);
                {% else %}background: rgba(241,196,15,0.25); color: #f1c40f;
                {% endif %}">{{ pi.status }} INTERPRETATION</span>
              <span style="color: var(--text-secondary);">{{ pi.season_name }}</span>
              {{ pi.raw_text|truncate(80) }}
            </div>
            {% endfor %}
          </td>
        </tr>
        {% endif %}
        {% if g.proposals %}
        <tr>
          <td colspan="11" style="padding: 0.25rem 1rem 0.75rem 2rem; border-top: none;">
            {% for p in g.proposals %}
            <div style="font-size: 0.8rem; margin-bottom: 0.25rem; line-height: 1.4;">
              <span class="mono" style="font-size: 0.7rem; padding: 0.1rem 0.4rem; border-radius: 3px; margin-right: 0.5rem;
                {% if p.status == 'passed' %}background: rgba(46,204,113,0.2); color: var(--accent-score);
                {% elif p.status == 'failed' %}background: rgba(231,76,60,0.2); color: var(--accent-game);
                {% elif p.status in ['confirmed', 'pending', 'pending_review'] %}background: rgba(155,89,182,0.2); color: var(--accent-gov);
                {% elif p.status in ['vetoed', 'rejected'] %}background: rgba(231,76,60,0.15); color: var(--accent-game);
                {% else %}background: rgba(255,255,255,0.1); color: var(--text-secondary);
                {% endif %}">{% if p.status == 'confirmed' %}AWAITING VOTE{% elif p.status == 'pending_review' %}ADMIN REVIEW{% else %}{{ p.status|upper }}{% endif %}</span>
              <span style="color: var(--text-secondary);">{{ p.season_name }}{% if p.round_number %} R{{ p.round_number }}{% endif %}</span>
              {{ p.raw_text|truncate(80) }}
            </div>
            {% endfor %}
          </td>
        </tr>
        {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endif %}
{% endblock %}
